<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Roadmaps - Career Bridge</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        primary: '#2563EB',
                        secondary: '#1E40AF',
                        accent: '#F59E0B',
                        dark: '#0F172A',
                        light: '#F8FAFC',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Lock Overlay Effect */
        .blurred-content {
            filter: blur(6px);
            user-select: none;
            pointer-events: none;
        }
        
        /* Drawer Animation */
        .drawer-enter { transform: translateX(100%); }
        .drawer-active { transform: translateX(0); }
        
        /* Card Hover Glow */
        .roadmap-card:hover {
            box-shadow: 0 10px 40px -10px rgba(37, 99, 235, 0.2);
            transform: translateY(-4px);
        }

        /* CHATBOT STYLES */
        .chat-message { max-width: 85%; margin-bottom: 1rem; padding: 0.75rem; border-radius: 1rem; font-size: 0.9rem; line-height: 1.5; }
        .chat-user { background-color: #2563EB; color: white; margin-left: auto; border-bottom-right-radius: 0.25rem; }
        .chat-ai { background-color: #F1F5F9; color: #334155; margin-right: auto; border-bottom-left-radius: 0.25rem; border: 1px solid #E2E8F0; }
        .typing-dot { width: 6px; height: 6px; background: #94a3b8; border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-light text-slate-700 font-sans antialiased overflow-x-hidden">

    <!-- NAVIGATION -->
    <nav class="fixed w-full z-50 bg-white/90 backdrop-blur-md shadow-sm border-b border-slate-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center gap-2">
                    <a href="index.html" class="flex items-center gap-2">
                        <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center text-white font-bold">
                            <i class="fa-solid fa-graduation-cap"></i>
                        </div>
                        <span class="font-bold text-xl text-dark tracking-tight">Career <span class="text-primary">Bridge</span></span>
                    </a>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-6 items-center">
                    <a href="index.html" class="text-slate-600 hover:text-primary font-medium transition">Home</a>
                    <a href="roadmaps.html" class="text-primary font-bold transition">Roadmaps</a>
                    <a href="selection.html" class="text-slate-600 hover:text-primary font-medium transition">Career Selection</a>
                    <a href="#" class="text-slate-600 hover:text-primary font-medium transition">Goal Tracker</a>
                    <a href="#" class="text-slate-600 hover:text-primary font-medium transition">1 on 1 Meetings</a>
                </div>

                <!-- Auth Buttons -->
                <div class="hidden md:flex items-center space-x-4" id="auth-buttons">
                    <a href="login.html" class="bg-primary hover:bg-secondary text-white px-5 py-2 rounded-full font-medium transition shadow-lg shadow-primary/30">Log In</a>
                </div>
                
                <!-- Mobile Menu Button -->
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-btn" class="text-slate-600"><i class="fa-solid fa-bars text-2xl"></i></button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-slate-100">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-slate-700">Home</a>
                <a href="roadmaps.html" class="block px-3 py-2 rounded-md text-base font-medium text-primary font-bold bg-slate-50">Roadmaps</a>
                <a href="selection.html" class="block px-3 py-2 rounded-md text-base font-medium text-slate-700">Career Selection</a>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-slate-700">Goal Tracker</a>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-slate-700">1 on 1 Meetings</a>
                <a href="login.html" id="mobile-login-link" class="block px-3 py-2 rounded-md text-base font-medium text-primary font-bold">Log In</a>
            </div>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <section class="pt-32 pb-12 bg-gradient-to-b from-white to-light">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <span class="bg-blue-100 text-primary text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Updated for 2025</span>
            <h1 class="text-4xl md:text-5xl font-extrabold text-dark mt-4 mb-6">
                Navigate Your <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">Tech Career</span>
            </h1>
            <p class="text-xl text-slate-500 max-w-2xl mx-auto">
                Step-by-step guides curated for the Pakistani industry. From local salary insights to the specific tools software houses in Lahore, Karachi, and Islamabad are looking for.
            </p>
        </div>
    </section>

    <!-- ROADMAPS GRID -->
    <section class="py-12 pb-24">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="roadmap-grid">
                <!-- Cards injected via JS -->
            </div>
        </div>
    </section>

    <!-- ROADMAP DRAWER (Slide-over) -->
    <div id="drawer-overlay" class="fixed inset-0 bg-black/50 z-[60] hidden transition-opacity opacity-0"></div>
    <div id="drawer" class="fixed inset-y-0 right-0 w-full md:w-[600px] bg-white z-[70] shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto">
        
        <!-- Drawer Header -->
        <div class="sticky top-0 bg-white/90 backdrop-blur-md border-b border-slate-100 p-6 flex justify-between items-center z-10">
            <div>
                <span id="d-category" class="text-xs font-bold text-accent uppercase tracking-wider">Development</span>
                <h2 id="d-title" class="text-2xl font-bold text-dark">Roadmap Title</h2>
            </div>
            <button onclick="closeDrawer()" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-slate-200 flex items-center justify-center transition">
                <i class="fa-solid fa-xmark text-slate-600"></i>
            </button>
        </div>

        <!-- Drawer Content -->
        <div class="p-6 md:p-8 space-y-8">
            
            <!-- Public Info -->
            <div class="bg-blue-50 rounded-xl p-6 border border-blue-100">
                <h3 class="font-bold text-dark mb-4 flex items-center gap-2">
                    <i class="fa-solid fa-chart-line text-primary"></i> Market Insights (Pakistan)
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-xs text-slate-500 uppercase">Avg. Starting Salary</p>
                        <p id="d-salary" class="font-bold text-dark text-lg">PKR 00k</p>
                    </div>
                    <div>
                        <p class="text-xs text-slate-500 uppercase">Demand Level</p>
                        <div id="d-demand" class="flex gap-1 mt-1"></div>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-blue-200">
                    <p class="text-xs text-slate-500 uppercase mb-2">Key Technologies</p>
                    <div id="d-tags" class="flex flex-wrap gap-2"></div>
                </div>
            </div>

            <div class="prose text-slate-600">
                <p id="d-description">Description goes here...</p>
            </div>

            <!-- PRIVATE CONTENT -->
            <div class="relative">
                <h3 class="font-bold text-2xl text-dark mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-list-check text-accent"></i> Learning Path
                </h3>
                <div id="d-steps-container" class="space-y-6 relative"></div>
                
                <!-- Lock Overlay -->
                <div id="lock-overlay" class="absolute inset-0 bg-gradient-to-b from-white/60 to-white z-10 flex flex-col items-center justify-center text-center p-6 hidden">
                    <div class="w-16 h-16 bg-white rounded-full shadow-xl flex items-center justify-center mb-4 text-3xl text-accent">
                        <i class="fa-solid fa-lock"></i>
                    </div>
                    <h4 class="text-xl font-bold text-dark mb-2">Unlock the Full Roadmap</h4>
                    <p class="text-slate-500 mb-6 max-w-xs">Create a free account to access detailed steps, resource links, and project ideas.</p>
                    <a href="login.html" class="bg-primary hover:bg-secondary text-white px-8 py-3 rounded-lg font-bold shadow-lg shadow-blue-500/30 transition transform hover:-translate-y-1">
                        Join to Unlock
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- CHATBOT (Floating Action Button) - REGISTERED ONLY (Hidden by default) -->
    <div id="chatbot-container" class="fixed bottom-6 right-6 z-50 hidden flex flex-col items-end gap-2">
        
        <!-- Helper Tooltip -->
        <div class="bg-white px-4 py-2 rounded-lg shadow-lg border border-slate-100 text-xs font-bold text-slate-600 mb-1 animate-bounce origin-bottom-right">
            Confused? Ask about any Roadmap! ðŸ‘‡
        </div>

        <!-- Chat Window -->
        <div id="chat-window" class="hidden bg-white w-80 sm:w-96 h-[500px] rounded-2xl shadow-2xl border border-slate-200 flex flex-col overflow-hidden animate-slide-up mb-2">
            <div class="bg-dark p-4 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-xs">
                        <i class="fa-solid fa-robot"></i>
                    </div>
                    <div>
                        <h4 class="text-white font-bold text-sm">Roadmap Guide</h4>
                        <p class="text-xs text-slate-400 flex items-center gap-1"><span class="w-2 h-2 bg-green-500 rounded-full"></span> Online</p>
                    </div>
                </div>
                <button onclick="toggleChat()" class="text-slate-400 hover:text-white transition"><i class="fa-solid fa-xmark"></i></button>
            </div>
            
            <div id="chat-messages" class="flex-grow overflow-y-auto p-4 space-y-4 bg-slate-50">
                <div class="chat-message chat-ai">
                    Hi! I'm here to explain any roadmap or technology. Ask me "What is Docker?" or "Is MERN stack good for freelancing?"
                </div>
            </div>

            <div class="p-4 bg-white border-t border-slate-100">
                <form onsubmit="handleChatSubmit(event)" class="flex gap-2">
                    <input type="text" id="chat-input" class="flex-grow border border-slate-300 rounded-lg px-4 py-2 text-sm focus:outline-none focus:border-primary" placeholder="Type your question..." required>
                    <button type="submit" class="bg-primary hover:bg-secondary text-white w-10 h-10 rounded-lg flex items-center justify-center transition">
                        <i class="fa-solid fa-paper-plane text-sm"></i>
                    </button>
                </form>
            </div>
        </div>

        <!-- Floating Button (Highlighted & Text Added) -->
        <button id="chat-fab" onclick="toggleChat()" class="group flex items-center gap-3 bg-primary hover:bg-secondary text-white pl-5 pr-2 py-2 rounded-full shadow-xl transition-all duration-300 hover:scale-105">
            <span class="font-bold text-sm tracking-wide">Ask AI Guide</span>
            <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-lg">
                <i class="fa-solid fa-comments"></i>
            </div>
        </button>
    </div>

    <!-- FOOTER -->
    <footer class="bg-dark text-slate-400 py-12 border-t border-slate-800 mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div class="col-span-1 md:col-span-2">
                    <div class="flex items-center gap-2 mb-4 text-white">
                        <i class="fa-solid fa-graduation-cap text-primary text-2xl"></i>
                        <span class="font-bold text-xl">Career Bridge</span>
                    </div>
                    <p class="text-sm leading-relaxed max-w-xs">
                        Empowering the next generation of Pakistani professionals with guidance, community, and opportunity.
                    </p>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-4">Quick Links</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="hover:text-primary transition">About Us</a></li>
                        <li><a href="#" class="hover:text-primary transition">Events</a></li>
                        <li><a href="#" class="hover:text-primary transition">Blog</a></li>
                        <li><a href="#" class="hover:text-primary transition">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-4">Connect</h4>
                    <div class="flex space-x-4">
                        <a href="https://www.facebook.com" target="_blank" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition">
                            <i class="fa-brands fa-facebook-f"></i>
                        </a>
                        <a href="https://www.linkedin.com" target="_blank" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition">
                            <i class="fa-brands fa-linkedin-in"></i>
                        </a>
                        <a href="https://twitter.com" target="_blank" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition">
                            <i class="fa-brands fa-twitter"></i>
                        </a>
                        <a href="https://www.instagram.com" target="_blank" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition">
                            <i class="fa-brands fa-instagram"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="border-t border-slate-800 pt-8 text-center text-xs">
                <p>&copy; 2025 Career Bridge Pakistan. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // --- CONFIGURATION ---
        const supabaseUrl = 'https://sbytszsxhkzehqrxgjrl.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNieXRzenN4aGt6ZWhxcnhnanJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2NTkwNTUsImV4cCI6MjA3OTIzNTA1NX0.Nm6Ig-M7eYtPB30O9jicqIg48Wont4uY4Kz2_3ibZ0c';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
        const GEMINI_API_KEY = 'AIzaSyAC7fznwr4XQ3MjZR-2TmQG_wajb4sa9Fo'; 

        const roadmaps = [
            {
                id: 1, title: "MERN Stack Developer", icon: "fa-layer-group", category: "Web Development", salary: "PKR 80k - 250k", demand: 5, tags: ["React.js", "Node.js", "MongoDB", "Next.js"],
                desc: "The most in-demand stack in Pakistani software houses. Master full-stack JS to build scalable web apps.",
                steps: [ { title: "HTML/CSS & Tailwind", desc: "Build responsive layouts. Forget Bootstrap, learn Tailwind CSS." }, { title: "JavaScript (ES6+)", desc: "Deep dive into Async/Await, Promises, and DOM manipulation." }, { title: "React.js ecosystem", desc: "Hooks, Context API, and Redux Toolkit." }, { title: "Backend with Node/Express", desc: "RESTful APIs, JWT Authentication, and MongoDB." }, { title: "Deployment", desc: "Deploy to Vercel (Frontend) and Render (Backend)." } ]
            },
            {
                id: 2, title: "AI & Data Scientist", icon: "fa-brain", category: "Artificial Intelligence", salary: "PKR 120k - 400k", demand: 5, tags: ["Python", "PyTorch", "LLMs", "Pandas"],
                desc: "The highest paying field globally. Focus on Generative AI and Python automation.",
                steps: [ { title: "Python Mastery", desc: "Data structures, OOP, and libraries like NumPy." }, { title: "Data Analysis", desc: "EDA using Matplotlib and Seaborn." }, { title: "Machine Learning Basics", desc: "Scikit-learn, Regression, Classification algorithms." }, { title: "Deep Learning", desc: "Neural Networks with PyTorch or TensorFlow." }, { title: "Generative AI", desc: "RAG pipelines, LangChain, and LLMs." } ]
            },
            {
                id: 3, title: "Cyber Security Analyst", icon: "fa-shield-halved", category: "Security", salary: "PKR 100k - 350k", demand: 5, tags: ["Linux", "Network Security", "Ethical Hacking", "SIEM"],
                desc: "Protect organizations from digital attacks. A critical role with a talent shortage.",
                steps: [ { title: "Networking Fundamentals", desc: "TCP/IP, OSI Model, DNS, and Firewalls." }, { title: "Linux Administration", desc: "Command line mastery (Kali Linux) and bash scripting." }, { title: "Ethical Hacking", desc: "Reconnaissance, scanning, and vulnerability assessment." }, { title: "Web App Security", desc: "OWASP Top 10 and Burp Suite." }, { title: "Blue Teaming", desc: "SIEM tools like Splunk/Wazuh." } ]
            },
            {
                id: 4, title: "Flutter Mobile Dev", icon: "fa-mobile-screen", category: "Mobile Development", salary: "PKR 90k - 300k", demand: 4, tags: ["Dart", "Flutter", "Firebase", "State Mgmt"],
                desc: "Build apps for iOS and Android with a single codebase. Popular in startups.",
                steps: [ { title: "Dart Fundamentals", desc: "Learn OOP and Async programming." }, { title: "Flutter UI", desc: "Rows, Columns, Stacks, and Material Design." }, { title: "State Management", desc: "Provider, Riverpod, or BLoC." }, { title: "API Integration", desc: "Fetching data using HTTP package." }, { title: "Native Features", desc: "Camera, GPS, and Notifications." } ]
            },
            {
                id: 5, title: "DevOps Engineer", icon: "fa-server", category: "Infrastructure", salary: "PKR 150k - 500k", demand: 4, tags: ["Docker", "Kubernetes", "AWS", "CI/CD"],
                desc: "The backbone of modern software. Bridge the gap between coding and operations.",
                steps: [ { title: "Linux & Scripting", desc: "Bash scripting is non-negotiable." }, { title: "Containerization", desc: "Docker and Dockerfiles." }, { title: "CI/CD Pipelines", desc: "GitHub Actions or GitLab CI." }, { title: "Cloud (AWS)", desc: "EC2, S3, RDS." }, { title: "Orchestration", desc: "Kubernetes basics." } ]
            },
            {
                id: 6, title: "Game Developer", icon: "fa-gamepad", category: "Game Dev", salary: "PKR 70k - 200k", demand: 3, tags: ["C#", "Unity 3D", "Physics", "Multiplayer"],
                desc: "Create immersive 2D and 3D experiences. A growing industry.",
                steps: [ { title: "C# Programming", desc: "Variables, Loops, OOP, and Events." }, { title: "Unity Interface", desc: "Scene view, Game view, and Inspector." }, { title: "Physics", desc: "Rigidbodies and Colliders." }, { title: "UI & Animation", desc: "Canvas system and Animator controller." }, { title: "Game Polish", desc: "Sound design and lighting." } ]
            },
            {
                id: 7, title: "UI/UX Designer", icon: "fa-pen-nib", category: "Design", salary: "PKR 60k - 180k", demand: 4, tags: ["Figma", "Prototyping", "User Research"],
                desc: "Design the look and feel of digital products.",
                steps: [ { title: "Design Principles", desc: "Typography, Color Theory, and Spacing." }, { title: "Figma Mastery", desc: "Auto-layout, Components, and Variants." }, { title: "UX Research", desc: "User personas and empathy mapping." }, { title: "Wireframing", desc: "Low-fidelity sketching." }, { title: "Developer Handoff", desc: "Preparing assets for coding." } ]
            },
            {
                id: 8, title: "Blockchain Developer", icon: "fa-link", category: "Web3", salary: "PKR 150k - 600k", demand: 3, tags: ["Solidity", "Ethereum", "Smart Contracts"],
                desc: "Build decentralized applications (DApps). High earning potential.",
                steps: [ { title: "Blockchain Basics", desc: "Ledgers, mining, and consensus." }, { title: "Solidity", desc: "Writing Smart Contracts on Ethereum." }, { title: "Contract Security", desc: "Gas optimization and auditing." }, { title: "Frontend Integration", desc: "Ethers.js or Wagmi." }, { title: "DeFi", desc: "Tokens (ERC-20) and NFTs." } ]
            },
            {
                id: 9, title: "Cloud Architect", icon: "fa-cloud-arrow-up", category: "Cloud", salary: "PKR 200k - 600k", demand: 5, tags: ["AWS", "Azure", "Terraform"],
                desc: "Design scalable cloud infrastructure. Great for remote roles.",
                steps: [ { title: "Cloud Basics", desc: "IaaS, PaaS, SaaS." }, { title: "AWS/Azure", desc: "EC2, S3, and databases." }, { title: "IaC", desc: "Terraform or CloudFormation." }, { title: "Serverless", desc: "AWS Lambda or Azure Functions." }, { title: "FinOps", desc: "Optimizing cloud spend." } ]
            },
            {
                id: 10, title: "SQA Automation", icon: "fa-bug", category: "QA", salary: "PKR 80k - 250k", demand: 5, tags: ["Selenium", "Cypress", "Python"],
                desc: "Ensure software quality through automated testing.",
                steps: [ { title: "Manual Testing", desc: "Test cases and bug reporting." }, { title: "Programming for QA", desc: "Python or Java basics." }, { title: "Web Automation", desc: "Selenium or Cypress." }, { title: "API Testing", desc: "Postman and RestAssured." }, { title: "Performance", desc: "JMeter or K6." } ]
            }
        ];

        let isLoggedIn = false;
        let chatHistory = [];

        async function checkUser() {
            const { data: { session } } = await supabaseClient.auth.getSession();
            if (session) {
                isLoggedIn = true;
                document.getElementById('auth-buttons').innerHTML = `<button onclick="handleLogout()" class="bg-slate-200 hover:bg-slate-300 text-slate-800 px-5 py-2 rounded-full font-medium">Sign Out</button>`;
                document.getElementById('mobile-login-link').style.display = 'none';
                
                // SHOW CHATBOT (Registered Only)
                document.getElementById('chatbot-container').classList.remove('hidden');
            }
            renderRoadmaps();
        }

        async function handleLogout() {
            await supabaseClient.auth.signOut();
            window.location.reload();
        }

        function renderRoadmaps() {
            const grid = document.getElementById('roadmap-grid');
            grid.innerHTML = roadmaps.map(map => `
                <div class="roadmap-card bg-white rounded-xl p-6 border border-slate-100 transition duration-300 cursor-pointer flex flex-col h-full" onclick="openDrawer(${map.id})">
                    <div class="flex items-start justify-between mb-4">
                        <div class="w-12 h-12 bg-blue-50 text-primary rounded-lg flex items-center justify-center text-2xl">
                            <i class="fa-solid ${map.icon}"></i>
                        </div>
                        <span class="bg-slate-100 text-slate-600 text-[10px] font-bold px-2 py-1 rounded uppercase">${map.category}</span>
                    </div>
                    <h3 class="text-xl font-bold text-dark mb-2">${map.title}</h3>
                    <p class="text-slate-500 text-sm mb-4 flex-grow">${map.desc}</p>
                    <div class="mt-4 pt-4 border-t border-slate-50 flex items-center justify-between text-sm">
                        <span class="font-semibold text-slate-700">Salary: ${map.salary}</span>
                        <span class="text-primary font-bold group-hover:translate-x-1 transition">View Path <i class="fa-solid fa-arrow-right ml-1"></i></span>
                    </div>
                </div>
            `).join('');
        }

        const drawer = document.getElementById('drawer');
        const overlay = document.getElementById('drawer-overlay');

        function openDrawer(id) {
            const data = roadmaps.find(r => r.id === id);
            if (!data) return;

            document.getElementById('d-category').innerText = data.category;
            document.getElementById('d-title').innerText = data.title;
            document.getElementById('d-description').innerText = data.desc;
            document.getElementById('d-salary').innerText = data.salary;
            document.getElementById('d-demand').innerHTML = Array(5).fill(0).map((_, i) => `<i class="fa-solid fa-star ${i < data.demand ? 'text-accent' : 'text-slate-200 text-xs'}"></i>`).join('');
            document.getElementById('d-tags').innerHTML = data.tags.map(t => `<span class="bg-white border border-slate-200 px-2 py-1 rounded text-xs font-medium text-slate-600">${t}</span>`).join('');

            const stepsContainer = document.getElementById('d-steps-container');
            const lockOverlay = document.getElementById('lock-overlay');

            stepsContainer.innerHTML = data.steps.map((step, index) => `
                <div class="flex gap-4">
                    <div class="flex flex-col items-center">
                        <div class="w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center font-bold text-sm shrink-0">${index + 1}</div>
                        <div class="h-full w-0.5 bg-slate-200 my-2 ${index === data.steps.length - 1 ? 'hidden' : ''}"></div>
                    </div>
                    <div class="pb-8">
                        <h4 class="font-bold text-dark text-lg">${step.title}</h4>
                        <p class="text-slate-500 text-sm mt-1 leading-relaxed">${step.desc}</p>
                    </div>
                </div>
            `).join('');

            if (isLoggedIn) {
                stepsContainer.classList.remove('blurred-content');
                lockOverlay.classList.add('hidden');
            } else {
                stepsContainer.classList.add('blurred-content');
                lockOverlay.classList.remove('hidden');
            }

            overlay.classList.remove('hidden');
            setTimeout(() => {
                overlay.classList.remove('opacity-0');
                drawer.classList.remove('translate-x-full');
            }, 10);
        }

        function closeDrawer() {
            drawer.classList.add('translate-x-full');
            overlay.classList.add('opacity-0');
            setTimeout(() => { overlay.classList.add('hidden'); }, 300);
        }
        overlay.addEventListener('click', closeDrawer);

        function toggleChat() {
            document.getElementById('chat-window').classList.toggle('hidden');
        }

        async function handleChatSubmit(e) {
            e.preventDefault();
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            appendMessage(message, 'user');
            input.value = '';
            const loadingId = appendLoading();

            const context = chatHistory.map(msg => `User: ${msg.user}\nAI: ${msg.ai}`).join('\n');
            const prompt = `You are a friendly Tech Roadmap Expert for Pakistani students. Explain technologies simply. If asked about salaries, mention PKR. Keep answers concise.\n\nHistory:\n${context}\n\nQuestion: ${message}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                document.getElementById(loadingId).remove();
                appendMessage(aiText, 'ai');
                chatHistory.push({user: message, ai: aiText});
            } catch (error) {
                document.getElementById(loadingId).remove();
                appendMessage("Connection error. Try again.", 'ai');
            }
        }

        function appendMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `chat-message ${sender === 'user' ? 'chat-user' : 'chat-ai'}`;
            div.innerHTML = text.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
            document.getElementById('chat-messages').appendChild(div);
            document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
        }

        function appendLoading() {
            const div = document.createElement('div');
            const id = 'loading-' + Date.now();
            div.id = id;
            div.className = `chat-message chat-ai flex gap-1 items-center`;
            div.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
            document.getElementById('chat-messages').appendChild(div);
            return id;
        }

        const btn = document.getElementById('mobile-menu-btn');
        const menu = document.getElementById('mobile-menu');
        if(btn) btn.addEventListener('click', () => menu.classList.toggle('hidden'));

        document.addEventListener('DOMContentLoaded', checkUser);
    </script>
</body>

</html>
